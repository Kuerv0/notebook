*------------------------------------------------------------------------------*
|                                Notas de clase                                |
*------------------------------------------------------------------------------*

                              1. Packet forwarding 
                        Sat Jan 25 09:27:42 AM -05 2025

     Network Device Communication
     Layer 2 Forwarding and Collision Domains

        Siempre que ocurre una colisión queremos que se vean afectados pocos
     elementos, por ende siempre vamos a querer minimizar los dominios de
     colisión. Los switches limitan los dominios de colisión, por ello vamos a
     preferirlos en lugar de un hub.

        En la actualidad es difícil encontrar escenarios donde se den
     colisiones, podría darse debebido a un equipo que trabaje en half-duplex,
     pero el comportamiento por defecto de los equipos actuales es full-duplex.

        Un switch envía un Unicast cuando el paquete tiene una MAC destino,
     cuando tiene una MAC ffff:ffff..., se envía por todos los puertos excepto
     por el que se envió, las vlan nos van a permitir separar los dominios de
     broadcast, para no afectar el ancho de banda de todos los equipos, las
     vlans son la primera solución para separar dominos de broadcast.
     
     Luego de crear los puertos, se debe asignar el puerto a la vlan
     switchport [espacio para comando]

        Los puertos troncales permiten el tráfico de múltiples vlans. Los
     puertos troncales vienen etiquetados y el protocolo que hace esta etiqueta
     es 802.1Q

     Existe una vlan con un propósito especial, se llama la vlan nativa, el cual
     reluce en un troncal, la vlan nativa tiene significado, relevancia en un
     troncal, la cual es aquella única vlan que en el troncal no lleva tag.
     Normalmente no se usa tanto, se usaba cuando por un flujo tenía problemas.
     Si el tráfico genera errores, prueben cambiando esa vlan por la vlan
     nativa, si realmente el problema es la etiquetada, saldrá a relucir, ahora
     mismo la gran mayoría de flujos soporta ser etiquetada.

     Por defecto, todas las vlan viajan por el troncal, pero esto se puede
     cambiar manualmente. Las vlan nuevas no son agregadas automáticamente si se
     usa el comando switchport trunk allowed vlan v, v1, v2

     La tabla de las direcciones MAC se va construyendo a medidad que haya
     flujos, esas son las denomiandas MACs dinámicas, el aprendizaje de las MAC
     se hacen durante la marcha, la tabla MAC la tienen los equipos capa 2, se
     va poblando de forma dinámica con las MAC origen, en entorno seguros, se
     puede agregar las MAC manualmente.

     Tabla condensada con informadción relevante
                                                          #show interface status

        Las decisiones en capa 3, se hacen basados en el encabezado de TCP/IP e
     Ethernet, por lo que el abre los paquetes y modifica de ser necesario. En
     esta tenemos tabla ARP

        La comunicación local es necesaria para incluir información en los
     paquetes, entonces cuando un PC quiere construir el paquete para un PC que
     está en la misma red, tiene toda la información que requiere para crear el
     paquete. Si no se sabe la MAC, ahí es donde se produce un arp request, el
     cual es un broadcast, el switch no sabe nada de arp, pero sabe qué es un
     broadcast en su capa, por lo que solo hace un broadcast preguntando por la
     IP.

  *---                                                                   ---*
  |La tabla ARP es un mappeo entre capa 2 y capa 3 en la comunicación local.|
  |             La tabla MAC es un mappeo entre capa 1 y capa 2.            |
  *---                                                                   ---*

     Los routers pueden tener IPs secundarias, pero no se acostumbra mucho,
     sino que se hacen subinterfaces, los protocolos de enrutamiento no
     funcionan tan bien con secundarias, la recomendación es usar subinterfaces
     en lugar de usar secundarias.

     En los switches, las direcciones se asignan en las SVI, también a un
     Switch de capa 3 se puede activar un puerto enrutado con on switchport.
     
     Cisco era el mejor enrutando, luego adquirió una empresa llamada Catalyst
     donde adquirió el conocimiento de switching. Los routers son equipos que
     toman decisiones basadas en software. La capa 2 es un direccionamiento
     físico, el router se puede convertir en un cuello de botella, porque todo
     el tráfico pasa por él. Los switches toman la decisión con mayor
     velocidad.
     
     Existe una primera forma de tomar decisiones, pero ya no la usamos, en
     esta conferencia que estamos teniendo en Webex, el computador de Omar Roa
     le envía toda la información al router, el router tiene una tabla de
     enrutamiento, que usa para tomar decisiones y cada mensaje tiene que hacer
     el mismo análisis, el procesamiento incluído en eso es vasto, pero luego
     Cisco implementó un cache, el cual consiste en recordar decisiones para
     posteriores paquetes que sean similares, esto se llama la cache de
     enrutamiento. 

     En load balancing, si tiene fast switching, balancea por flujo, si no,
     balancea por paquetes.
     
     Tomar decision paquete a paquete no ip-route cache
     
     Cisco crea un algoritmo de forwarding donde el router concatena el arp con
     la ip routing table, este es el llamado CEF, lo que busca es que la
     decisión se aún más veloz que fast switching.
     
     Podría darse el caso que la IA empiece a tomar decisiones de enrutamiento.
     Ya hay equipos que están separados y se pueden conectar con algo externo
     para que le dé la mejor decisión posible.
     
     Los switches tienen unos recursos, los recursos los tiene distribuidos de
     cierta manera. Por ejemplo la RAM y el procesador se pueden concentrar en
     las vlan, entonces para poder atender 1000 vlans, por ejemplo, necesita
     distribuir los recursos, pero si se necesita ipv6, ya no se podría tener
     1000 vlans, esto es lo que llamamos SDM Templates, normalmente.
                                                                       #show sdm

*------------------------------------------------------------------------------*
|                                   Lecturas                                   |
*------------------------------------------------------------------------------*

                        Sun Jan 26 02:25:13 PM -05 2025

     Chapter 1: Packet Forwarding
        Today, almost everything is based on Transmission Control
     Protocol/Internet Protocol (TCP/IP). It is important to note that TCP/IP is
     based on the conceptual Open Systems Interconnection (OSI) model that is
     composed of seven layers.

      *---------*--------------*-------------------------------------------*
      | Layer 7 | Application  | Interface for receiving and sending data  |
      | Layer 6 | Presentation | Formatting data and encryption            |
      | Layer 5 |   Session    | Tracking of packets                       |
      | Layer 4 |  Transport   | End-to-end communication betweeen devices |
      | Layer 3 |   Network    | Logical addressing and routing of packets |
      | Layer 2 |  Data Link   | Hardware addressing                       |
      | Layer 1 |   Physical   | Media type and connector                  |
      *---------*--------------*-------------------------------------------*
      OSI Model

        The first Layer 2 network devices were bridges or switches, and Layer 3
     devices were strictly routers. As technology advanced, the develop- ment of
     faster physical media required the ability to forward packets in hardware
     through application-specific integrated circuits (ASICs). As ASIC
     functionality continued to develop, multilayer switches (MLSs) were
     invented to forward Layer 2 traffic in hardware as if they were switches;
     however, they can also perform other functions, such as routing packets,
     from a Layer 3 perspective.

     Layer 2 Forwarding
        The second layer of the OSI model, the data link layer, handles
     addressing beneath the IP protocol stack. Ethernet commonly uses Media
     Access Control (MAC) addresses, and other data link layer protocols such as
     Frame Relay use an entirely different method of Layer 2 addressing.

*------------------------------------ NOTE ------------------------------------*
|    A MAC address is a 48-bit address that is split across six octets and     |
|  notated in 1 hexadecimal. The first three octets are assigned to a device   |
| manufacturer, known as the organizationally unique identifier (OUI), and the |
|   manufacturer is responsible for ensuring that the last three octets are    |
|unique. A device listens for network traffic that contains its MAC address as |
|   the packet’s destination MAC address before moving the packet up the OSI   |
|    stack to Layer 3 for processing.  Network broadcasts with MAC address     |
| FF:FF:FF:FF:FF:FF are the exception to the rule and will always be processed |
|    by all network devices on the same network segment. Broadcasts are not    |
|                typically forwarded beyond a Layer 3 boundary.                |
*------------------------------------------------------------------------------*

        A collision occurs when two or more network devices tries to transmit
     data at the same time in the same network segment.

     A collision domain is a network segment where one device can detect if
     another device is transmitting data.

                               Ethernet includes:
            Carrier Sense Multiple Access/Collision Detect (CSMA/CD)

        Network switches enhance scalability and stability in a network through
     the creation of virtual channels. A switch maintains a table that
     associates a host’s Media Access Control (MAC) Ethernet addresses to the
     port that sourced the network traffic.

        A switch receives a packet that contains a MAC that is not in the
     switch's MAC address table, the switch forwards the packet out of every
     switch port, other than the port the packet was received on. This process
     is known as unknown unicast flooding.

        Broadcast traffic is network traffic intended for every host on the
     local area network (LAN). Network broadcasts do not cross Layer 3
     boundaries.

        All devices that reside in the same Layer 2 segment are considered to be
     in the same broadcast domain.

 Virtual LANs (VLANs) [802.1Q] provide logical segmentation by creating multiple broadcast 
domains on the same network switch. Network devices in one VLAN cannot com
municate with devices in a different VLAN without a router to interconnect the VLAN 
segments.

                      *---------------------------*
                      | TPID   | PCP | DEI | VLAN | 802.1Q                    
                      | 0x8100 |     |     |  ID  | Fields         
                      *---------------------------*

The VLAN identifier has only 12 bits, which provide 4094 unique VLANs. Catalyst switches
use the following logic for VLAN identifiers:

 ■ VLAN 0 is reserved for 802.1p traffic and cannot be modified or deleted.
 ■ VLAN 1 is the default VLAN and cannot be modified or deleted.
 ■ VLANs 2 to 1001 are in the normal VLAN range and can be added, deleted, or
   modified as necessary.
 ■ VLANs 1002 to 1005 are reserved and cannot be deleted.
 ■ VLANs 1006 to 4094 are in the extended VLAN range and can be added, deleted, or
   modified as necessary.

An access port is assigned to only one VLAN. It carries traffic from the
specified VLAN to the device connected to it or viceversa. The 802.1Q tags are
not included on packets transmitted or received on access ports.

Trunk ports can carry multiple VLANs. Trunk ports are typically used when
multiple VLANs need connectivity between a switch and another switch, router, or
firewall and use only one port.

In the 802.1Q standard, any traffic that is transmitted or received on a trunk
port without the 802.1Q VLAN tag is associated to the native VLAN. The default
native VLAN is VLAN 1.

The MAC address table is responsible for identifying the switch ports and VLANs
with which a device is associated.

The MAC address table resides in content addressable memory (CAM), which is RAM,
but faster.

There are two main methodologies for Layer 3 forwarding:

■ Forwarding traffic to devices on the same subnet
■ Forwarding traffic to devices on a different subnet

The Address Resolution Protocol (ARP) table provides a method of mapping Layer 3
IP addresses to Layer 2 MAC addresses by storing the IP address of a host and
its corre sponding MAC address.

Reading IP Address Assignment.
